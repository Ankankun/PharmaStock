<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PharmaStock | View Stock</title>
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/medicine.png" />
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/script.js" defer></script>
  </head>

  <body>
    <!-- Navbar Section -->
    <div class="navbar">
      <div class="logo">
        <a href="/">
          <img src="/assets/Pharma Stock Logo svg.svg" alt="logo" />
        </a>
      </div>
      <div class="menu-items">
        <a href="/view-stock">Stock</a>
        <a href="/customer">Customer</a>
        <a href="/payment">Payment</a>
        <a href="/feedback">Feedback</a>
        <a href="/sell">Sales</a>
        <a href="/account">Account</a>
        <div class="account-dropdown">
          <a href="#" class="account-toggle">
            <img src="/assets/account-symbol.svg" alt="account-symbol" />
          </a>
          <div class="dropdown-menu">
            <div class="dropdown-header">
              <strong><%= user.first_name %></strong>
              <small><%= user.shop_name || 'My Shop' %></small>
            </div>
            <div class="dropdown-body">
              <p><%= user.email %></p>
              <p><%= user.phone %></p>
            </div>
            <div class="dropdown-footer">
              <a href="/account" class="btn-logout-dropdown" style="background-color: #3d5a80; margin-bottom: 5px;">Profile</a>
              <a href="/logout" class="btn-logout-dropdown">Logout</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- View Stock Section -->
    <main class="stock-layout">
        <aside class="stock-sidebar">
            <h2>STOCKS</h2>
            <div class="sidebar-divider"></div>
            <nav class="stock-nav">
                <button class="btn-sidebar" onclick="window.location.href='/add-stock'">Add +</button>
                <button class="btn-sidebar active" onclick="window.location.href='/view-stock'">View</button>
                <button class="btn-sidebar" onclick="window.location.href='/update-stock'">Update</button>
                <button class="btn-sidebar" onclick="window.location.href='/sell'">Sell</button>
            </nav>
            <div class="sidebar-divider bottom"></div>
        </aside>

        <section class="stock-content">
            
            <div class="view-stock-header">
                <h1>Current Inventory</h1>
                <form class="search-bar" action="/view-stock" method="GET">
                    <input type="text" name="search" placeholder="Search Name, Batch, Rack..." value="<%= typeof search !== 'undefined' ? search : '' %>">
                    <button type="submit" class="btn-search">Search</button>
                </form>
            </div>

            <div class="table-container">
                <table class="stock-table" id="stockTable">
                    <thead>
                        <tr>
                            <th>Batch No</th>
                            <th>Medicine Name</th>
                            <th>Expiry Date</th>
                            <th>Quantity</th>
                            <th>Rack</th>
                            <th>Price</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if(medicines.length > 0) { %>
                            <% medicines.forEach(med => { %>
                                <tr>
                                    <td><%= med.batch_no %></td>
                                    <td><strong><%= med.med_name %></strong></td>
                                    
                                    <!-- Only inline style here is for the Dynamic Date Logic -->
                                    <td style="<%= new Date(med.expiry_date) < new Date() ? 'color: #d9534f; font-weight:bold;' : '' %>">
                                        <%= med.expiry_date %>
                                    </td>
                                    
                                    <td><%= med.quantity %></td>
                                    <td><%= med.rack_no %></td>
                                    <td>â‚¹<%= med.consumer_cost %></td>
                                    
                                    <!-- Uses your .status classes -->
                                    <td>
                                        <% if (new Date(med.expiry_date) < new Date()) { %>
                                            <span class="status out-of-stock">Expired</span>
                                        <% } else if (med.quantity < 10) { %>
                                            <span class="status low-stock">Low Stock</span>
                                        <% } else { %>
                                            <span class="status in-stock">In Stock</span>
                                        <% } %>
                                    </td>
                                </tr>
                            <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 20px;">No stock records found.</td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>

        </section>
    </main>

    <!-- Footer Section -->
    <footer>
      <div class="footer">
        <a href="about.html">About</a>
        <a href="help.html">Help Center</a>
        <a href="tos.html">Terms of Service</a>
        <a href="policy.html">Privacy Policy</a>
        <a href="email.html">Email</a>
      </div>
      <div class="socials">
        <img src="/assets/Social-Instagram.svg" alt="Instagram-icon" />
        <img src="/assets/Social-fb.svg" alt="Facebook-icon" />
        <img src="/assets/Social-twitter.svg" alt="Twitter-icon" />
      </div>
    </footer>
  </body>
</html>
